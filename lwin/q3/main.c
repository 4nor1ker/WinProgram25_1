/*
 * 예상문제 5: 별자리 애니메이션 예제 코드 (속도 초기화 포함)
 * - 화면 중앙에 육망성(별) 고정
 * - 작은 별이 육망성을 반시계방향으로 공전
 * - 'A' 키: 공전 속도 2배 증가
 * - 'Z' 키: 공전 속도 0.5배 감소
 * - 'R' 키: 공전 속도를 초기값으로 되돌림
 */

#include <GLFW/glfw3.h>     // OpenGL과 창 관리를 위한 GLFW 라이브러리
#include <windows.h>        // GetAsyncKeyState 함수 사용 (윈도우 키보드 입력)
#include <math.h>           // 삼각함수 계산용 (cos, sin)

#pragma comment(lib, "opengl32.lib")  // OpenGL 라이브러리 링크 설정

#define PI 3.1415926535f    // 원주율 상수

 // -------------------------------------------------------------
 // (1) 육망성 별 그리기 함수
 // r: 별의 반지름
 // 삼각형 2개(위/아래)를 겹쳐서 육망성(6각형) 형태로 표현
 // -------------------------------------------------------------
void drawHexagram(float r) {
    float h = r * sqrtf(3.0f) / 2.0f;  // 정삼각형 높이 계산

    glBegin(GL_TRIANGLES);
    // 첫 번째 삼각형 (위쪽을 향하는 삼각형)
    glVertex2f(0.0f, r);               // 위쪽 꼭짓점
    glVertex2f(-h, -r * 0.5f);         // 왼쪽 아래 꼭짓점
    glVertex2f(h, -r * 0.5f);          // 오른쪽 아래 꼭짓점

    // 두 번째 삼각형 (아래쪽을 향하는 역삼각형)
    glVertex2f(0.0f, -r);              // 아래쪽 꼭짓점
    glVertex2f(-h, r * 0.5f);          // 왼쪽 위 꼭짓점
    glVertex2f(h, r * 0.5f);           // 오른쪽 위 꼭짓점
    glEnd();
}

// -------------------------------------------------------------
// (2) 원형 그리기 함수 (작은 별)
// r: 원의 반지름
// seg: 원을 몇 등분으로 나눌지 (seg가 클수록 원이 부드럽게 보임)
// -------------------------------------------------------------
void drawCircle(float r, int seg) {
    glBegin(GL_TRIANGLE_FAN);
    glVertex2f(0.0f, 0.0f);  // 중심점
    for (int i = 0; i <= seg; ++i) {
        // 0도부터 360도까지 seg개로 나눠서 원을 그림
        float a = 2.0f * PI * i / seg;
        glVertex2f(cosf(a) * r, sinf(a) * r);
    }
    glEnd();
}

// -------------------------------------------------------------
// (3) 메인 함수
// -------------------------------------------------------------
int main(void) {
    // GLFW 초기화 실패 시 종료
    if (!glfwInit()) return -1;

    // 800x600 크기의 창 생성
    GLFWwindow* window = glfwCreateWindow(800, 600, "Constellation Animation", NULL, NULL);
    if (!window) {
        glfwTerminate();
        return -1;
    }
    glfwMakeContextCurrent(window);  // OpenGL 컨텍스트 설정

    // 2D 좌표계 설정 (-1 ~ 1)
    glOrtho(-1, 1, -1, 1, -1, 1);

    // -------------------------------------------------------------
    // (4) 애니메이션 변수 초기화
    // -------------------------------------------------------------
    float angle = 0.0f;                 // 작은 별 공전 각도 (누적)
    const float baseSpeed = 0.5f;       // 기본 공전 속도
    float speed = baseSpeed;            // 현재 공전 속도

    const float bigStarRadius = 0.3f;   // 중앙 육망성 반지름
    const float smallStarRadius = 0.05f;// 작은 별 반지름
    const float orbitRadius = 0.6f;     // 작은 별 공전 반경

    // -------------------------------------------------------------
    // (5) 메인 루프: 창이 닫힐 때까지 반복
    // -------------------------------------------------------------
    while (!glfwWindowShouldClose(window)) {
        // -------------------------------------------------------------
        // (5-1) 키 입력 처리
        // 'A' 키: 공전 속도 2배 증가
        // 'Z' 키: 공전 속도 0.5배 감소
        // 'R' 키: 공전 속도를 기본속도로 초기화
        // -------------------------------------------------------------
        if (GetAsyncKeyState('A') & 0x8000) {
            speed *= 2.0f;
            if (speed > 5.0f) speed = 5.0f;  // 최대속도 제한
        }
        if (GetAsyncKeyState('Z') & 0x8000) {
            speed *= 0.5f;
            if (speed < 0.05f) speed = 0.05f;  // 최소속도 제한
        }
        if (GetAsyncKeyState('R') & 0x8000) {
            speed = baseSpeed;  // 기본속도로 되돌리기
        }

        // -------------------------------------------------------------
        // (5-2) 공전 각도 업데이트
        // speed값을 누적하여 angle값 증가 → 공전 애니메이션
        // -------------------------------------------------------------
        angle += speed;

        // -------------------------------------------------------------
        // (5-3) 화면 초기화 (검정 배경)
        // -------------------------------------------------------------
        glClearColor(0.0f, 0.0f, 0.0f, 1.0f);  // 검정색
        glClear(GL_COLOR_BUFFER_BIT);

        // -------------------------------------------------------------
        // (5-4) 중앙 육망성 별 그리기
        // -------------------------------------------------------------
        glPushMatrix();                   // 현재 좌표계 저장
        glColor3f(1.0f, 1.0f, 0.0f);      // 노란색
        drawHexagram(bigStarRadius);      // 육망성 별 그리기
        glPopMatrix();                    // 좌표계 복원

        // -------------------------------------------------------------
        // (5-5) 작은 별 공전
        // 공전 각도만큼 회전 → 반시계방향 공전
        // glRotatef(angle, 0,0,1) → angle각도로 Z축 회전
        // glTranslatef(orbitRadius, 0,0) → 궤도 반경만큼 x축 이동
        // -------------------------------------------------------------
        glPushMatrix();                   // 좌표계 저장
        glRotatef(angle, 0, 0, 1);        // 공전 회전
        glTranslatef(orbitRadius, 0.0f, 0.0f);  // 궤도 반경 이동
        glColor3f(1.0f, 1.0f, 1.0f);      // 작은 별 색상: 흰색
        drawCircle(smallStarRadius, 32); // 작은 별 그리기
        glPopMatrix();                    // 좌표계 복원

        // -------------------------------------------------------------
        // (5-6) 화면 출력 (더블버퍼)
        // -------------------------------------------------------------
        glfwSwapBuffers(window);
        glfwPollEvents();                 // 이벤트 처리
    }

    // -------------------------------------------------------------
    // (6) 프로그램 종료 처리
    // -------------------------------------------------------------
    glfwTerminate();
    return 0;
}
